[merge.py] dist_mode=ddp, is_distributed=True, world_size=4, device=cuda:0
[merge.py] Using subset_fraction=0.5 â†’ keeping 3846/7693 tickers
Prices:   (15429052, 11)
News:     (2560402, 3)
Indexes:  (14280, 4)
[merge.py] Total headlines: 2560402, world_size=4, per_rankâ‰ˆ640101
[Rank 0] headlines shard: 640101 rows (start=0, end=640101)
[Rank 3] headlines shard: 640099 rows (start=1920303, end=2560402)
[Rank 2] headlines shard: 640101 rows (start=1280202, end=1920303)
[FinBERT] Loading fine-tuned weights from models/run3.safetensors ...
[FinBERT] Loading fine-tuned weights from models/run3.safetensors ...
[FinBERT] Loading fine-tuned weights from models/run3.safetensors ...
[Rank 1] headlines shard: 640101 rows (start=640101, end=1280202)
[Rank 0] Encoded 256/640101 headlines...
[Rank 3] Encoded 256/640099 headlines...
[Rank 2] Encoded 256/640101 headlines...
[FinBERT] Loading fine-tuned weights from models/run3.safetensors ...
[Rank 1] Encoded 256/640101 headlines...
[Rank 3] Encoded 13056/640099 headlines...
[Rank 0] Encoded 13056/640101 headlines...
[Rank 2] Encoded 13056/640101 headlines...
[Rank 1] Encoded 13056/640101 headlines...
[Rank 3] Encoded 25856/640099 headlines...
[Rank 0] Encoded 25856/640101 headlines...
[Rank 2] Encoded 25856/640101 headlines...
[Rank 3] Encoded 38656/640099 headlines...
[Rank 1] Encoded 25856/640101 headlines...
[Rank 0] Encoded 38656/640101 headlines...
[Rank 3] Encoded 51456/640099 headlines...
[Rank 2] Encoded 38656/640101 headlines...
[Rank 1] Encoded 38656/640101 headlines...
[Rank 3] Encoded 64256/640099 headlines...
[Rank 0] Encoded 51456/640101 headlines...
[Rank 1] Encoded 51456/640101 headlines...
[Rank 2] Encoded 51456/640101 headlines...
[Rank 3] Encoded 77056/640099 headlines...
[Rank 0] Encoded 64256/640101 headlines...
[Rank 1] Encoded 64256/640101 headlines...
[Rank 3] Encoded 89856/640099 headlines...
[Rank 0] Encoded 77056/640101 headlines...
[Rank 2] Encoded 64256/640101 headlines...
[Rank 1] Encoded 77056/640101 headlines...
[Rank 3] Encoded 102656/640099 headlines...
[Rank 0] Encoded 89856/640101 headlines...
[Rank 3] Encoded 115456/640099 headlines...
[Rank 2] Encoded 77056/640101 headlines...
[Rank 1] Encoded 89856/640101 headlines...
[Rank 0] Encoded 102656/640101 headlines...
[Rank 3] Encoded 128256/640099 headlines...
[Rank 1] Encoded 102656/640101 headlines...
[Rank 2] Encoded 89856/640101 headlines...
[Rank 3] Encoded 141056/640099 headlines...
[Rank 0] Encoded 115456/640101 headlines...
[Rank 1] Encoded 115456/640101 headlines...
[Rank 3] Encoded 153856/640099 headlines...
[Rank 0] Encoded 128256/640101 headlines...
[Rank 2] Encoded 102656/640101 headlines...
[Rank 3] Encoded 166656/640099 headlines...
[Rank 1] Encoded 128256/640101 headlines...
[Rank 0] Encoded 141056/640101 headlines...
[Rank 2] Encoded 115456/640101 headlines...
[Rank 3] Encoded 179456/640099 headlines...
[Rank 1] Encoded 141056/640101 headlines...
[Rank 0] Encoded 153856/640101 headlines...
[Rank 3] Encoded 192256/640099 headlines...
[Rank 2] Encoded 128256/640101 headlines...
[Rank 1] Encoded 153856/640101 headlines...
[Rank 0] Encoded 166656/640101 headlines...
[Rank 3] Encoded 205056/640099 headlines...
[Rank 3] Encoded 217856/640099 headlines...
[Rank 0] Encoded 179456/640101 headlines...
[Rank 2] Encoded 141056/640101 headlines...
[Rank 1] Encoded 166656/640101 headlines...
[Rank 3] Encoded 230656/640099 headlines...
[Rank 0] Encoded 192256/640101 headlines...
[Rank 1] Encoded 179456/640101 headlines...
[Rank 2] Encoded 153856/640101 headlines...
[Rank 3] Encoded 243456/640099 headlines...
[Rank 0] Encoded 205056/640101 headlines...
[Rank 1] Encoded 192256/640101 headlines...
[Rank 3] Encoded 256256/640099 headlines...
[Rank 2] Encoded 166656/640101 headlines...
[Rank 0] Encoded 217856/640101 headlines...
[Rank 1] Encoded 205056/640101 headlines...
[Rank 3] Encoded 269056/640099 headlines...
[Rank 2] Encoded 179456/640101 headlines...
[Rank 3] Encoded 281856/640099 headlines...
[Rank 0] Encoded 230656/640101 headlines...
[Rank 1] Encoded 217856/640101 headlines...
[Rank 3] Encoded 294656/640099 headlines...
[Rank 0] Encoded 243456/640101 headlines...
[Rank 1] Encoded 230656/640101 headlines...
[Rank 2] Encoded 192256/640101 headlines...
[Rank 3] Encoded 307456/640099 headlines...
[Rank 0] Encoded 256256/640101 headlines...
[Rank 1] Encoded 243456/640101 headlines...
[Rank 3] Encoded 320256/640099 headlines...
[Rank 2] Encoded 205056/640101 headlines...
[Rank 0] Encoded 269056/640101 headlines...
[Rank 3] Encoded 333056/640099 headlines...
[Rank 1] Encoded 256256/640101 headlines...
[Rank 2] Encoded 217856/640101 headlines...
[Rank 3] Encoded 345856/640099 headlines...
[Rank 0] Encoded 281856/640101 headlines...
[Rank 1] Encoded 269056/640101 headlines...
[Rank 3] Encoded 358656/640099 headlines...
[Rank 2] Encoded 230656/640101 headlines...
[Rank 0] Encoded 294656/640101 headlines...
[Rank 1] Encoded 281856/640101 headlines...
[Rank 3] Encoded 371456/640099 headlines...
[Rank 0] Encoded 307456/640101 headlines...
[Rank 1] Encoded 294656/640101 headlines...
[Rank 3] Encoded 384256/640099 headlines...
[Rank 2] Encoded 243456/640101 headlines...
[Rank 1] Encoded 307456/640101 headlines...
[Rank 0] Encoded 320256/640101 headlines...
[Rank 3] Encoded 397056/640099 headlines...
[Rank 2] Encoded 256256/640101 headlines...
[Rank 3] Encoded 409856/640099 headlines...
[Rank 0] Encoded 333056/640101 headlines...
[Rank 1] Encoded 320256/640101 headlines...
[Rank 3] Encoded 422656/640099 headlines...
[Rank 0] Encoded 345856/640101 headlines...
[Rank 2] Encoded 269056/640101 headlines...
[Rank 1] Encoded 333056/640101 headlines...
[Rank 3] Encoded 435456/640099 headlines...
[Rank 0] Encoded 358656/640101 headlines...
[Rank 3] Encoded 448256/640099 headlines...
[Rank 1] Encoded 345856/640101 headlines...
[Rank 2] Encoded 281856/640101 headlines...
[Rank 0] Encoded 371456/640101 headlines...
[Rank 3] Encoded 461056/640099 headlines...
[Rank 1] Encoded 358656/640101 headlines...
[Rank 2] Encoded 294656/640101 headlines...
[Rank 3] Encoded 473856/640099 headlines...
[Rank 0] Encoded 384256/640101 headlines...
[Rank 1] Encoded 371456/640101 headlines...
[Rank 3] Encoded 486656/640099 headlines...
[Rank 2] Encoded 307456/640101 headlines...
[Rank 0] Encoded 397056/640101 headlines...
[Rank 1] Encoded 384256/640101 headlines...
[Rank 3] Encoded 499456/640099 headlines...
[Rank 0] Encoded 409856/640101 headlines...
[Rank 3] Encoded 512256/640099 headlines...
[Rank 2] Encoded 320256/640101 headlines...
[Rank 1] Encoded 397056/640101 headlines...
[Rank 3] Encoded 525056/640099 headlines...
[Rank 0] Encoded 422656/640101 headlines...
[Rank 1] Encoded 409856/640101 headlines...
[Rank 2] Encoded 333056/640101 headlines...
[Rank 3] Encoded 537856/640099 headlines...
[Rank 0] Encoded 435456/640101 headlines...
[Rank 1] Encoded 422656/640101 headlines...
[Rank 3] Encoded 550656/640099 headlines...
[Rank 2] Encoded 345856/640101 headlines...
[Rank 0] Encoded 448256/640101 headlines...
[Rank 1] Encoded 435456/640101 headlines...
[Rank 3] Encoded 563456/640099 headlines...
[Rank 2] Encoded 358656/640101 headlines...
[Rank 0] Encoded 461056/640101 headlines...
[Rank 3] Encoded 576256/640099 headlines...
[Rank 1] Encoded 448256/640101 headlines...
[Rank 3] Encoded 589056/640099 headlines...
[Rank 0] Encoded 473856/640101 headlines...
[Rank 1] Encoded 461056/640101 headlines...
[Rank 2] Encoded 371456/640101 headlines...
[Rank 3] Encoded 601856/640099 headlines...
[Rank 0] Encoded 486656/640101 headlines...
[Rank 1] Encoded 473856/640101 headlines...
[Rank 3] Encoded 614656/640099 headlines...
[Rank 2] Encoded 384256/640101 headlines...
[Rank 0] Encoded 499456/640101 headlines...
[Rank 1] Encoded 486656/640101 headlines...
[Rank 3] Encoded 627456/640099 headlines...
[Rank 2] Encoded 397056/640101 headlines...
[Rank 3] Encoded 640099/640099 headlines...
[Rank 0] Encoded 512256/640101 headlines...
[Rank 1] Encoded 499456/640101 headlines...
[Rank 0] Encoded 525056/640101 headlines...
[Rank 2] Encoded 409856/640101 headlines...
[Rank 1] Encoded 512256/640101 headlines...
[Rank 0] Encoded 537856/640101 headlines...
[Rank 1] Encoded 525056/640101 headlines...
[Rank 2] Encoded 422656/640101 headlines...
[Rank 0] Encoded 550656/640101 headlines...
[Rank 1] Encoded 537856/640101 headlines...
[Rank 2] Encoded 435456/640101 headlines...
[Rank 0] Encoded 563456/640101 headlines...
[Rank 1] Encoded 550656/640101 headlines...
[Rank 2] Encoded 448256/640101 headlines...
[Rank 0] Encoded 576256/640101 headlines...
[Rank 1] Encoded 563456/640101 headlines...
[Rank 0] Encoded 589056/640101 headlines...
[Rank 1] Encoded 576256/640101 headlines...
[Rank 2] Encoded 461056/640101 headlines...
[Rank 0] Encoded 601856/640101 headlines...
[Rank 1] Encoded 589056/640101 headlines...
[Rank 2] Encoded 473856/640101 headlines...
[Rank 0] Encoded 614656/640101 headlines...
[Rank 1] Encoded 601856/640101 headlines...
[Rank 0] Encoded 627456/640101 headlines...
[Rank 2] Encoded 486656/640101 headlines...
[Rank 1] Encoded 614656/640101 headlines...
[Rank 0] Encoded 640101/640101 headlines...
[Rank 2] Encoded 499456/640101 headlines...
[Rank 1] Encoded 627456/640101 headlines...
[Rank 1] Encoded 640101/640101 headlines...
[Rank 2] Encoded 512256/640101 headlines...
[Rank 2] Encoded 525056/640101 headlines...
[Rank 2] Encoded 537856/640101 headlines...
[Rank 2] Encoded 550656/640101 headlines...
[Rank 2] Encoded 563456/640101 headlines...
[Rank 2] Encoded 576256/640101 headlines...
[Rank 2] Encoded 589056/640101 headlines...
[Rank 2] Encoded 601856/640101 headlines...
[Rank 2] Encoded 614656/640101 headlines...
[Rank 2] Encoded 627456/640101 headlines...
[Rank 2] Encoded 640101/640101 headlines...
[merge.py] Global daily_news shape after gather: (1196251, 773)
[merge.py] Dropped 3846 rows with NaN target_ret1 (last days per ticker).
[merge.py] Saved merged dataset to data/data/merged_lstm_dataset_half.parquet with shape (15425206, 785)

[merge.py] Benchmark (seconds):
  load_data        = 100.347
  finbert_init     = 2.559
  embed_local_rank0= 101.781
  embed_global_max = 123.093
  merge+save       = 565.202
  total            = 819.570
